Описание протокола интеграции Такси Навигатора с CallCenter



Обмен сообщениями Такси Навигатора с CallCenter происходит по TCP/IP в формате PlainText.



Число портов на которые ТН может принимать сообщения равно количеству колонн в компании. 



Каждая колонна принимает сообщения на свой порт. Также для каждой колонны определяется 



свой исходящий порт на который отправляется сообщение в CallCenter при исходящем звонке.



CallCenter информирует ТН о входящем звонке (напимер с номера 0675040279) отправкой 



текстового сообщения на указанный в настройках порт по протоколу TCP/IP.  При этом в ТН 



поднимается форма нового заказа с указанным номером телефона и классом автомобиля на 



заказ.



Message: Call \r\n



CallerID: 0675040279 \r\n



CarType: Universal  \r\n \r\n



где CarType — класс автомобиля, в ТН устанавливается  соотв тариф. Варианты: 



    General - 'Базовый'    Universal -  'Универсал'



    Business - 'Бизнес-класс'    Minibus - 'Микроавтобус'



    Premium - 'Премиум-класс'



При получении сообщения ТН отсылает ответ:



Message: ACK  \r\n



Error: OK  \r\n \r\n



Для того, чтобы CallCenter позвонил на определенный номер, передаётся:



Message: Dial  \r\n



Tel: 0675040279  \r\n \r\n



Модуль автодозвона клиентам для оповещения о статусе заказа



При нажатии соотв. клавиши ТН отправляет в CallCenter сообщение:



Message: SayText  \r\n



NumberToCall: 0930100128  \r\n



TextToSay: <Тут текст сообщения> \r\n



Guid: 6F9619FF-8B86-D011-B42D-00CF4FC964FF  \r\n \r\n



где Guid — идентификатор звонка по соотв заказу



При получении сообщения (Message: SayText) CallCenter должен при каждом изменении статуса 



звонка отсылать ответ:



Message: SayTextStatus \r\n



Guid: 6F9619FF-8B86-D011-B42D-00CF4FC964FF \r\n



Status:  Queued \r\n



StatusChangedTime: 03.11.2010 15:21:30 \r\n \r\n



где Guid — идентификатор звонка переданый в сообщении (Message: SayText);



где Status — статус звонка в который он перешел. Варианты: 



Done - выполнен дозвон, была снята трубка.



Busy - выполнен дозвон, было занято.



Unreachable - выполнен дозвон, но телефон недоступен.



Active -  выполняется дозвон



Unanswered - выполнен дозвон, не была снята трубка.



Canceled - дозвон еще не выполнялся и уже отменен или отсутствует в базе.



Queued - дозвон еще не выполнялся, но пока ожидает освобождение канала.



*Команды-ответы приходят не подключившемуся TCP-клиенту, а на заданный в настройках CallCenter IP-адрес 



и порт. Например, клиент с IP-адреса 192.168.1.100 отправляет команду SayText, а SayTextStatus приходит на 



192.168.1.200:6001



Для организации конференции между водителем и пассажиром



Создать tcp/ip соединение на iport коллвея



Выслать туда



"Message: Conference\r\nTel1: " + m_Phone1 + "\r\nTel2: " + m_Phone2 + "\r\n\r\n"



m_Phone1 - телефон водителя.



m_Phone1 - телефон пассажира.



Формат - 10 цифр.



Типа 0501234567



Прочитать ответ.



Если это 2 строки "Message:ACK" и "Error:OK", то запрос принят.
